<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PostMapper">

<insert id="reg" parameterType="pvo">
	insert into post (writer, files, content)
	values(#{writer}, #{files}, #{content})
</insert>

<select id="list" resultType="pvo">
	select writer, reg_at, mod_at, read_cnt, count(l.email) as like_cnt
	from post p left join `like` l on p.post_id = l.post_id group by p.post_id
</select>

<select id="one" parameterType="long" resultType="pvo">
	select writer, reg_at, mod_at, read_cnt, files, content, count(l.email) as like_cnt
	from post p left join `like` l on p.post_id = l.post_id where p.post_id = #{postId} group by p.post_id
</select>

<update id="addCnt" parameterType="long">
	update set read_cnt = read_cnt + 1 where post_id = #{postId}
</update>

<update id="mod" parameterType="pvo">
	update post set files = #{files}, content = #{content} , mod_at = now()
	where post_id = #{postId}
</update>

<delete id="del" parameterType="long">
	delete from post where post_id = #{postId}
</delete>

</mapper>